<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>العالمية NEWS | نبض العالم بين يديك</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700;800&family=Playfair+Display:wght@700;800&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: '#c00',
                        dark: '#121212',
                    },
                    fontFamily: {
                        sans: ['Noto Sans Arabic', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>

    <style>
        .news-gradient {
            background: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.9));
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        @keyframes ticker {
            0% {
                transform: translateX(100%);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        .animate-ticker {
            animation: ticker 60s linear infinite;
        }

        .animate-ticker:hover {
            animation-play-state: paused;
        }

        .pulse-red {
            box-shadow: 0 0 0 0 rgba(204, 0, 0, 0.7);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(204, 0, 0, 0.7);
            }

            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(204, 0, 0, 0);
            }

            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(204, 0, 0, 0);
            }
        }
    </style>
</head>

<body class="bg-[#f8f8f8] text-dark font-sans">

    <!-- Top Bar -->
    <div class="bg-dark text-white text-[11px] py-2">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div id="current-date">الخميس، 8 يناير 2026</div>
            <div class="flex gap-4 items-center">
                <div id="live-indicator" class="hidden flex items-center gap-2 text-brand font-bold">
                    <span class="w-2 h-2 bg-brand rounded-full pulse-red"></span>
                    تغطية مباشرة
                </div>
                <span>العربية</span>
                <span class="opacity-50">English</span>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <button class="md:hidden text-gray-600"><i data-lucide="menu"></i></button>
            <div class="text-3xl md:text-4xl font-serif font-800 tracking-tighter">
                العالمية<span class="text-brand">NEWS</span>
            </div>
            <div class="flex items-center gap-4">
                <i data-lucide="search" class="text-gray-500 cursor-pointer hover:text-brand"></i>
            </div>
        </div>
        <!-- Navigation -->
        <nav class="hidden md:block border-t border-gray-100">
            <div class="container mx-auto px-4">
                <ul class="flex gap-8 text-sm font-bold text-gray-600">
                    <li class="py-3 border-b-2 border-brand text-brand cursor-pointer">الرئيسية</li>
                    <li
                        class="py-3 border-b-2 border-transparent hover:border-brand hover:text-brand cursor-pointer transition-all">
                        سياسة</li>
                    <li
                        class="py-3 border-b-2 border-transparent hover:border-brand hover:text-brand cursor-pointer transition-all">
                        اقتصاد</li>
                    <li
                        class="py-3 border-b-2 border-transparent hover:border-brand hover:text-brand cursor-pointer transition-all">
                        رياضة</li>
                    <li
                        class="py-3 border-b-2 border-transparent hover:border-brand hover:text-brand cursor-pointer transition-all">
                        تكنولوجيا</li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Breaking News Ticker -->
    <div class="bg-white border-b border-gray-200 overflow-hidden flex">
        <div class="bg-brand text-white px-6 py-2 font-bold text-sm z-10 shadow-lg relative">عاجل</div>
        <div class="flex-1 overflow-hidden flex items-center bg-gray-50">
            <p id="ticker-text" class="animate-ticker whitespace-nowrap font-medium text-sm text-gray-800">
                جارٍ تحميل آخر الأخبار العاجلة...
            </p>
        </div>
    </div>

    <main class="container mx-auto px-4 py-8">
        <!-- New News Notification -->
        <div id="new-news-banner"
            class="hidden bg-brand text-white text-center py-3 rounded-lg shadow-xl cursor-pointer mb-8 font-bold transform transition hover:scale-[1.01]">
            هناك أخبار جديدة متاحة - اضغط للتحديث
        </div>

        <div id="loading-state" class="py-20 text-center">
            <div class="inline-block w-12 h-12 border-4 border-brand border-t-transparent rounded-full animate-spin">
            </div>
            <p class="mt-4 text-gray-500">جلب آخر الأنباء...</p>
        </div>

        <div id="news-content" class="hidden">
            <!-- Hero Section -->
            <section id="hero-section"
                class="mb-12 group cursor-pointer relative overflow-hidden rounded-xl h-[450px] bg-black">
                <!-- Will be injected by JS -->
            </section>

            <!-- Secondary Grid -->
            <section id="secondary-grid"
                class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12 border-b border-gray-200 pb-12">
                <!-- Will be injected by JS -->
            </section>

            <!-- Main Content + Sidebar -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                <div class="lg:col-span-2">
                    <h3 class="text-xl font-bold border-r-4 border-brand pr-4 mb-8">آخر المستجدات</h3>
                    <div id="latest-feed" class="space-y-8">
                        <!-- Will be injected by JS -->
                    </div>

                    <!-- Pagination -->
                    <div class="flex justify-center items-center gap-6 mt-16">
                        <button id="prev-btn"
                            class="flex items-center gap-2 px-6 py-2 border border-gray-300 rounded hover:bg-gray-100 disabled:opacity-30">السابق
                            <i data-lucide="chevron-left" class="w-4 h-4"></i></button>
                        <span id="page-info" class="font-bold">صفحة 1</span>
                        <button id="next-btn"
                            class="flex items-center gap-2 px-6 py-2 border border-gray-300 rounded hover:bg-gray-100 disabled:opacity-30">التالي
                            <i data-lucide="chevron-right" class="w-4 h-4"></i></button>
                    </div>
                </div>

                <!-- Sidebar -->
                <aside class="space-y-12">
                    <div class="bg-white p-6 border border-gray-200">
                        <h3 class="text-lg font-bold border-b-2 border-dark pb-2 mb-6">الأكثر قراءة</h3>
                        <div id="trending-list" class="space-y-6">
                            <!-- Will be injected by JS -->
                        </div>
                    </div>

                    <div class="bg-dark text-white p-8 rounded-2xl relative overflow-hidden group">
                        <div class="relative z-10">
                            <h3 class="text-2xl font-bold mb-4">اشترك في نشرتنا</h3>
                            <p class="text-gray-400 text-sm mb-6">احصل على ملخص يومي لأهم الأنباء العالمية مباشرة في
                                بريدك.</p>
                            <input type="email" placeholder="بريدك الإلكتروني"
                                class="w-full bg-white/10 border border-white/20 rounded-lg py-3 px-4 mb-4 focus:outline-none focus:border-brand transition-all">
                            <button
                                class="w-full bg-brand py-3 rounded-lg font-bold hover:bg-red-700 transition-all">اشترك
                                الآن</button>
                        </div>
                        <div
                            class="absolute -bottom-10 -left-10 w-40 h-40 bg-brand/10 rounded-full blur-3xl group-hover:bg-brand/20 transition-all">
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </main>

    <footer class="bg-dark text-white py-16 mt-20">
        <div class="container mx-auto px-4 text-center">
            <div class="text-3xl font-serif font-800 mb-8">العالمية<span class="text-brand">NEWS</span></div>
            <div class="flex flex-wrap justify-center gap-8 text-sm text-gray-400 mb-12">
                <a href="#" class="hover:text-white transition-all">من نحن</a>
                <a href="#" class="hover:text-white transition-all">سياسة الخصوصية</a>
                <a href="#" class="hover:text-white transition-all">شروط الاستخدام</a>
                <a href="#" class="hover:text-white transition-all">اتصل بنا</a>
            </div>
            <p class="text-gray-500 text-xs">© 2026 شبكة العالمية الإخبارية. جميع الحقوق محفوظة.</p>
        </div>
    </footer>

    <script>
        // Configuration
        const API_URL = window.location.origin.includes('localhost') ? 'http://localhost:8002/api' : '/api';
        const WS_URL = window.location.origin.includes('localhost') ? 'ws://localhost:8002/ws' : `ws://${window.location.host.replace('http', 'ws')}/ws`;

        let currentPage = 1;
        let allNews = [];
        let pendingNews = [];
        let totalItems = 0;

        // Initialize Icons
        lucide.createIcons();

        // Update Date
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('current-date').innerText = new Date().toLocaleDateString('ar-EG', options);

        // Fetch News
        async function fetchNews(page = 1) {
            document.getElementById('loading-state').classList.remove('hidden');
            if (page === 1) document.getElementById('news-content').classList.add('hidden');

            try {
                const response = await fetch(`${API_URL}/news?page=${page}&limit=20`);
                const data = await response.json();
                allNews = data.items;
                totalItems = data.total;
                currentPage = data.page;

                renderUI();
            } catch (error) {
                console.error('Error fetching news:', error);
            } finally {
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('news-content').classList.remove('hidden');
                lucide.createIcons();
            }
        }

        function getThumbnailUrl(videoUrl) {
            // Extract video ID and create thumbnail URL
            const videoId = videoUrl.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/)?.[1];
            if (videoId) {
                return `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
            }
            return 'https://images.unsplash.com/photo-1504711434969-e33886168f5c?q=80&w=2070';
        }

        function renderUI() {
            if (allNews.length === 0) return;

            // 1. Ticker
            const tickerItems = allNews.slice(0, 10).map(n => `<span class="inline-block px-4 underline decoration-brand/30 hover:text-brand cursor-pointer">${n.title}</span>`).join(' <span class="text-brand font-bold mx-2">/</span> ');
            document.getElementById('ticker-text').innerHTML = tickerItems;

            // 2. Hero Section
            const hero = allNews[0];
            const heroThumbnail = hero.image_url || getThumbnailUrl(hero.link);
            document.getElementById('hero-section').innerHTML = `
                <a href="${hero.link}" target="_blank">
                    <img src="${heroThumbnail}" class="w-full h-full object-cover opacity-60 group-hover:scale-105 transition-transform duration-700">
                    <div class="absolute inset-0 news-gradient flex flex-col justify-end p-8 md:p-12">
                        <span class="bg-brand text-white text-xs font-bold px-3 py-1 mb-4 w-fit uppercase">${hero.source}</span>
                        <h2 class="text-3xl md:text-5xl font-serif text-white font-bold leading-tight max-w-4xl">${hero.title}</h2>
                    </div>
                </a>
            `;

            // 3. Secondary Grid (next 3 items)
            const secondary = allNews.slice(1, 4);
            document.getElementById('secondary-grid').innerHTML = secondary.map(item => {
                const thumb = item.image_url || getThumbnailUrl(item.link);
                return `
                <a href="${item.link}" target="_blank" class="group">
                    <div class="aspect-video overflow-hidden rounded-lg mb-4 bg-gray-200">
                        <img src="${thumb}" class="w-full h-full object-cover group-hover:scale-110 transition-all duration-500">
                    </div>
                    <span class="text-brand text-xs font-bold uppercase mb-2 block">${item.source}</span>
                    <h3 class="text-lg font-bold group-hover:text-brand transition-colors">${item.title}</h3>
                </a>
            `;
            }).join('');

            // 4. Latest Feed (rest of news)
            const latest = allNews.slice(4);
            document.getElementById('latest-feed').innerHTML = latest.map(item => {
                const thumb = item.image_url || getThumbnailUrl(item.link);
                return `
                <div class="flex gap-6 items-start border-b border-gray-100 pb-8 last:border-0">
                    <div class="flex-1">
                        <span class="text-brand text-xs font-bold uppercase mb-1 block">${item.source}</span>
                        <a href="${item.link}" target="_blank"><h3 class="text-xl font-bold mb-3 hover:text-brand transition-all">${item.title}</h3></a>
                        <p class="text-gray-500 text-sm line-clamp-2 mb-4 leading-relaxed">${item.summary || ''}</p>
                        <div class="flex items-center gap-4 text-xs text-gray-400 font-medium">
                            <span class="flex items-center gap-1"><i data-lucide="clock" class="w-3 h-3"></i> ${new Date(item.published).toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' })}</span>
                        </div>
                    </div>
                    <div class="w-32 h-24 md:w-48 md:h-32 rounded-lg overflow-hidden shrink-0">
                        <img src="${thumb}" class="w-full h-full object-cover">
                    </div>
                </div>
            `;
            }).join('');

            // 5. Trending Sidebar
            document.getElementById('trending-list').innerHTML = allNews.slice(0, 6).map((item, idx) => `
                <div class="flex gap-4 group cursor-pointer">
                    <span class="text-3xl font-serif font-bold text-gray-200 group-hover:text-brand transition-colors">0${idx + 1}</span>
                    <p class="text-sm font-bold leading-snug group-hover:text-brand transition-all line-clamp-2">${item.title}</p>
                </div>
            `).join('');

            // Pagination Controls
            const totalPages = Math.ceil(totalItems / 20);
            document.getElementById('page-info').innerText = `صفحة ${currentPage} من ${totalPages || 1}`;
            document.getElementById('prev-btn').disabled = currentPage === 1;
            document.getElementById('next-btn').disabled = currentPage >= totalPages;
        }

        // WebSockets for Real-time
        function connectWS() {
            try {
                const ws = new WebSocket(WS_URL);
                ws.onopen = () => {
                    document.getElementById('live-indicator').classList.remove('hidden');
                };
                ws.onmessage = (event) => {
                    const message = JSON.parse(event.data);
                    if (message.type === 'new_news') {
                        pendingNews.push(message.data);
                        document.getElementById('new-news-banner').innerText = `هناك ${pendingNews.length} أخبار جديدة - اضغط للتحديث`;
                        document.getElementById('new-news-banner').classList.remove('hidden');
                    }
                };
                ws.onclose = () => {
                    document.getElementById('live-indicator').classList.add('hidden');
                    setTimeout(connectWS, 5000);
                };
                ws.onerror = () => {
                    // Silently handle errors
                };
            } catch (e) {
                // WebSocket not available, continue without it
            }
        }

        // Event Listeners
        document.getElementById('new-news-banner').onclick = () => {
            allNews = [...pendingNews, ...allNews].slice(0, 20);
            pendingNews = [];
            document.getElementById('new-news-banner').classList.add('hidden');
            renderUI();
            window.scrollTo({ top: 0, behavior: 'smooth' });
            lucide.createIcons();
        };

        document.getElementById('prev-btn').onclick = () => {
            if (currentPage > 1) {
                fetchNews(currentPage - 1);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        };

        document.getElementById('next-btn').onclick = () => {
            fetchNews(currentPage + 1);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        // Initial Load
        fetchNews();
        connectWS();

    </script>
</body>

</html>